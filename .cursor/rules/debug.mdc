---
description: 
globs: 
alwaysApply: false
---
1â€¯. Coreâ€¯Codingâ€¯Philosophy
* Functional & Declarative: pure function; avoid classes/sideâ€‘effects.
* Singleâ€‘Responsibility + DRY: one job per unit; reuse modules, helpers, hooks.
* Readable First: descriptive names, short functions, consistent layout/format.
* RORO: Receiveâ€‘Object / Returnâ€‘Object pattern for all public APIs.
* No Magic Literals: replace with named constants.
2â€¯. TypeScriptâ€¯/Â JavaScript Standards
Area	Guideline
Syntax	Use function; drop semicolons.
Types	Interfacesâ€¯>â€¯type aliases; avoid enum, prefer maps.
Conditionals	Oneâ€‘liner if (cond) doX() where possible; eliminate redundant else.
Structure	kebab-case directories; file order â†’ export â†’ subâ€‘components â†’ helpers â†’ static data â†’ types.
3â€¯. Error Handling & Validation
* Guard clauses first; log context; happy path last.
* Custom error classes/factories; expected errors returned (not thrown) in Server Actions.
* Input validated by Zod; services throw userâ€‘readable errors for TanStackÂ Query.
4â€¯. ReactÂ / Next.jsâ€¯14
* Functional tsx components; default Server Components.
* "use client" only for small Webâ€‘API widgets.
* Server Actions via next-safe-action; return ActionResponse.
* Forms: react-hook-form + useActionState.
* <Suspense> + dynamic import for nonâ€‘critical UI; error boundaries (app/error.tsx, app/global-error.tsx).
* Track WebÂ Vitals (LCP, CLS, FID); serve images as WebP, lazy loaded.
5â€¯. UIÂ & Styling
* Shadcnâ€¯UI + Radixâ€¯UI + Tailwindâ€¯Aria.
* Mobileâ€‘first utilities, no inline styles.
* UI primitives documented in Storybook.
6â€¯. Services & Data
* Business logic in services/; throw humanâ€‘readable errors.
* Modular, iterative design; reusable hooks/helpers.
7â€¯. Documentation & Comments
* Explain why, not what; remove outdated remarks.
* TSDoc on all exports; Architecture Decision Records (/docs/adr/) for major choices.
8â€¯. Cleanâ€‘Code Practices
* Continuous refactor; encapsulate nested conditionals in named functions.
* Replace hardâ€‘coded values with constants; ensure version compatibility & security.
9â€¯. Testing & Quality Assurance
* Unit tests (Vitest/Jest) for every public function.
* Integration/E2E: Playwright for critical flows (auth, payments).
* Snapshot tests only for stable UI primitives.
* Mutation testing (Stryker) with â‰¥â€¯60â€¯% surviving mutants before merge.
* Lighthouse a11y â‰¥â€¯95; keyboardâ€‘only E2E for interactive pages.
10â€¯. Security & Accessibility
* Enforce OWASPâ€¯Topâ€¯10 mitigations; secrets in vault (.env only locally).
* CI fails on â€œhighâ€ severity npm audit/Snyk issues.
* CSP, HSTS, COOP/COEP headers in next.config.js.
* Radix componentsâ€™ ARIA roles verified after composition.
11â€¯. Performance
* JS bundle â‰¤â€¯250â€¯kB gzip per route; LCP image â‰¤â€¯100â€¯kB.
* Edge Runtime for latencyâ€‘sensitive endpoints; static/immutable cache headers + CDN.
* Webâ€‘Vitals telemetry sent to analytics; p95 latency monitored.
12â€¯. Observability & Logging
* Structured logs (pino) with traceâ€‘id propagation.
* Sentry error aggregation with source maps.
* OpenTelemetry traces â†’ Grafana Tempo dashboards.
13â€¯. CI/CD & Version Control
* Conventional Commits syntax:<type>[optional scope]: <description>
* 
* [optional body]
* 
* [optional footer(s)]
* Types: feat, fix, docs, style, refactor, test, chore, ci, perf, build; append ! or BREAKING CHANGE: for majors.
* Trunkâ€‘based flow; Husky preâ€‘commit (lint, typeâ€‘check, test); semanticâ€‘release for versioning.
* Blueâ€‘green or canary deploy via Vercel.
14â€¯. Infrastructure as Code
* Terraform modules per cloud service; remote state lock (S3â€¯+â€¯DynamoDB).
* PRâ€‘level terraform plan reviewed before apply.
15â€¯. Code Review & Workflow Directives
* â‰¤â€¯400â€¯LOC per PR; â€œship small, ship oftenâ€.
* Review checklist: naming, SRP, tests, a11y, security, perf budgets, docs.
* Provide full diff in one block; preserve unrelated code; no whitespaceâ€‘only patches.
* Persistentâ€¯Taskâ€¯Logâ€¯Workflow
    1. On every prompt:
        * Check for change_log2025.md.
        * If present, read and start on the first unchecked task.
        * If absent, create it using the skeleton below.
    2. Task List Maintenance:
        * Update - [ ] â” - [x] (âœ…Â Done) when completing tasks.
        * Append new tasks chronologically; never overwrite.
    3. PR Gate: PR merges only when its task is ticked and followâ€‘ups appended.
* change_log2025.md Skeleton# Change Log 2025
* 
* ## ğŸ“Œ Task List
* - [ ] <short task title>
* 
* ---
* 
* ## ğŸ” Analysis
* <background / root cause>
* 
* ## ğŸ› ï¸ Functions / Components
* <API signatures, data contracts, file paths>
* 
* ## ğŸš€ Action Plan
* <stepâ€‘byâ€‘step roadmap>
* 
* ## âš ï¸ Problems & Risks
* <edge cases, blockers>
* 
* ## ğŸ’¡ Recommendations
* <refactors, techâ€‘debt cleanup>
* 
16â€¯. Developerâ€¯Experience & Documentation
* OpenAPI spec generated from Zod (zod-to-openapi) and published.
* ADRs, Storybook, and comprehensive README kept current.
17â€¯. Internationalization & Feature Flags
* next-intl with default locale en-US; ICU MessageFormat; compileâ€‘time checks.
* Feature flags via ConfigCat/LaunchDarkly (kebab-case names); killâ€‘switch until 100â€¯% rollout.

